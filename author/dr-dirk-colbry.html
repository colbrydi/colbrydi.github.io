<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Dirk's Home Page - Dr. Dirk Colbry</title>
    <meta name="description" content="">
    <meta name="author" content="Dr. Dirk Colbry">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="../theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="../theme/bootstrap.min.css" rel="stylesheet">
    <link href="../theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="../theme/local.css" rel="stylesheet">
    <link href="../theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->
        <link href="https://colbrydi.github.io/feeds/all.atom.xml" rel="alternate" title="Dirk's Home Page" type="application/atom+xml">

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
   <img src="../images/2017Dirk.jpg" align="left" width=100 hspace="20">

    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="..">Dirk's Home Page</a>

        <div class="nav-collapse">
        <ul class="nav">
            <li><a href="/pages/teaching.html">Teaching</a></li>
            <li><a href="/category/professional.html">Blog</a></li>
            <li><a href="/pages/publications.html">Publications</a></li>
            <li><a href="/pages/contact.html">Contact</a></li>
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="../using-an-x11-virtual-frame-buffer-to-run-gui-jobs-in-batch-mode-on-the-hpc.html"><h1>Using an X11 Virtual Frame buffer to run GUI jobs in batch mode on the HPC.</h1></a>
Thu 20 December 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 
        </div>
        
        <div><p><img align="right," alt="X11 Logo" hspace="10" src="//upload.wikimedia.org/wikipedia/commons/a/ab/X11.png" width="20%,"></p>
<p>I have an example program that came with <a href="http://bccd.net/">BCCD</a> called Pandemic which I wanted to run on our local HPCC. Unfortunatly Pandemic requires X11 to run and I would get a segmentation fault everytime I ran it in the batch system.</p>
<p>This blog post shows how I used the X11 Virtual Frame Buffer (Xvfb) to enable X11 in batch mode.  This example uses SLURM running in CentOS7.  </p>
<p>First, here is the batch script for the OpenMP version.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --time=00:10:00</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --cpus-per-task=16</span>
<span class="c1">#SBATCH --mem=10G</span>
<span class="c1">#SBATCH --job-name Pandemic-OpenMP</span>

<span class="nb">cd</span> <span class="si">${</span><span class="nv">SLURM_SUBMIT_DIR</span><span class="si">}</span>

<span class="c1"># Have X11 find an open display number and communicate the number</span>
<span class="c1"># though a temporary file to set the environment variable.</span>
<span class="nv">display_file</span><span class="o">=</span>.tmp_display.txt
Xvfb -displayfd <span class="m">1</span> -auth /dev/null  <span class="m">1</span>&gt;<span class="nv">$display_file</span> <span class="m">2</span>&gt; /dev/null <span class="p">&amp;</span>
sleep <span class="m">5</span>
<span class="nb">export</span> <span class="nv">DISPLAY</span><span class="o">=</span>:<span class="sb">`</span>cat <span class="nv">$display_file</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;DISPLAY set to </span><span class="nv">$DISPLAY</span><span class="s2">&quot;</span>
rm <span class="nv">$display_file</span>

<span class="c1"># Benchmark program with different numbers of processes</span>
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">16</span>
<span class="nb">time</span> ./Pandemic.c-openmp
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">8</span>
<span class="nb">time</span> ./Pandemic.c-openmp
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">4</span>
<span class="nb">time</span> ./Pandemic.c-openmp
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">2</span>
<span class="nb">time</span> ./Pandemic.c-openmp
<span class="nb">export</span> <span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">1</span>
<span class="nb">time</span> ./Pandemic.c-openmp
<span class="nb">echo</span> <span class="k">done</span>

<span class="c1"># Report job statistics</span>
scontrol show job <span class="nv">$SLURM_JOB_ID</span>
</pre></div>


<p>And here is the job I got working with MPI. Notice it is basically the same but I need to pass the DISPLAY variable though MPI for it to work.  </p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --time=00:10:00</span>
<span class="c1">#SBATCH --ntasks=16</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --mem=10G</span>
<span class="c1">#SBATCH --job-name Pandemic</span>

<span class="nb">cd</span> <span class="si">${</span><span class="nv">SLURM_SUBMIT_DIR</span><span class="si">}</span>
module swap GNU Intel
module load OpenMPI

<span class="c1"># Have X11 find an open display number and communicate the number</span>
<span class="c1"># though a temporary file to set the environment variable.</span>
<span class="nv">display_file</span><span class="o">=</span>.tmp_display.txt
Xvfb -displayfd <span class="m">1</span> -auth /dev/null  <span class="m">1</span>&gt;<span class="nv">$display_file</span> <span class="m">2</span>&gt; /dev/null <span class="p">&amp;</span>
sleep <span class="m">5</span>
<span class="nb">export</span> <span class="nv">DISPLAY</span><span class="o">=</span>:<span class="sb">`</span>cat <span class="nv">$display_file</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">&quot;DISPLAY set to </span><span class="nv">$DISPLAY</span><span class="s2">&quot;</span>
rm <span class="nv">$display_file</span>

<span class="c1"># Benchmark program with different numbers of processes</span>
<span class="nb">time</span> mpirun -n <span class="m">16</span> -x <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$HOSTNAME</span>:<span class="nv">$DISPLAY</span> ./Pandemic.c-mpi
<span class="nb">time</span> mpirun -n <span class="m">8</span> -x <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$HOSTNAME</span>:<span class="nv">$DISPLAY</span> ./Pandemic.c-mpi
<span class="nb">time</span> mpirun -n <span class="m">4</span> -x <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$HOSTNAME</span>:<span class="nv">$DISPLAY</span> ./Pandemic.c-mpi
<span class="nb">time</span> mpirun -n <span class="m">2</span> -x <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$HOSTNAME</span>:<span class="nv">$DISPLAY</span> ./Pandemic.c-mpi
<span class="nb">time</span> mpirun -n <span class="m">1</span> -x <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$HOSTNAME</span>:<span class="nv">$DISPLAY</span> ./Pandemic.c-mpi

<span class="c1"># Report job statistics</span>
scontrol show job <span class="nv">$SLURM_JOB_ID</span>
</pre></div>


<p>Hope you find this useful.</p></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="../alexa-dot-holder.html"><h2>Alexa Dot Holder</h2></a>
        <div class= "well small"> Sun 16 September 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Alexa Dot Wall Mount" hspace="10" src="../images/Alexa.jpg" width="25%,"></p>
<p>My brother got me an Alexa Dot for Christmas a few years ago.  It turns out to be a lot of fun. We put it in the kitchen and the kids play music.  My wife and I also use it to add things to our shopping list (very convenient!) Anyway …</p> <a class="btn btn-info xsmall" href="../alexa-dot-holder.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../3d-printed-switch-guard.html"><h2>3D printed Switch Guard</h2></a>
        <div class= "well small"> Wed 15 August 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Picture of the switch" hspace="10" src="../images/Switch2.jpg" width="25%,"></p>
<p>We recently moved into a new house and the kids are having fun running around turning on and off all the lights. Unfortunately, some of the light switches are not for lights. One goes to our garbage disposal, another goes to the gas fireplace and another turns off the furnace …</p> <a class="btn btn-info xsmall" href="../3d-printed-switch-guard.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../emerging-technologies-fpgas-2018-aci-ref-vr.html"><h2>Emerging Technologies (FPGAs) @ 2018 ACI-REF VR</h2></a>
        <div class= "well small"> Fri 10 August 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Picture from Panel" hspace="10" src="//colbrydi.github.io/images/Emerging_Technologies.jpg" width="20%,"></p>
<p>Today is the last day of the <a href="http://www.oscer.ou.edu/acirefvirtres2018.php">2018 ACI-REF Virtual residency</a> workshop here in Norman Ok.  It was a great week with a lot of great people.  I highly recommend the workshop for anyone in the area of Advanced Computing Instruction especially those do some Research and Education Facilitation in …</p> <a class="btn btn-info xsmall" href="../emerging-technologies-fpgas-2018-aci-ref-vr.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../deciding-which-technologies-to-adopt-and-when-2018-aci-ref-vr.html"><h2>Deciding Which Technologies to Adopt, and When @ 2018 ACI-REF VR</h2></a>
        <div class= "well small"> Wed 08 August 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Image used in presentation representing the technology adoption wave" hspace="10" src="//colbrydi.github.io/images/Wave.jpg" width="30%,"></p>
<p>I had fun leading a discussion on <strong>Deciding Which Technologies to Adopt, and When</strong> at the <a href="http://www.oscer.ou.edu/acirefvirtres2018.php">2018 ACI-REF Virtual residency</a> event in Norman Oklahoma. Since many of the participants were virtual I experimented with doing a Brainstorming exercise over zoom. We had local volunteers on typing in comments from our …</p> <a class="btn btn-info xsmall" href="../deciding-which-technologies-to-adopt-and-when-2018-aci-ref-vr.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../teams-of-ci-professionals-recruitment-retention-management-team-building-and-motivation-panel-2018-aci-ref-vr.html"><h2>Teams of CI Professionals: Recruitment & Retention, Management, Team-building, and Motivation Panel @ 2018 ACI-REF VR</h2></a>
        <div class= "well small"> Tue 07 August 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Image from Panel" hspace="10" src="//colbrydi.github.io/images/Audience.jpg" width="20%,"></p>
<p>Thank you Aaron Bergstrom (U North Dakota) for facilitating the panel discussion on <strong>Teams of CI Professionals: Recruitment &amp; Retention, Management, Team-building, and Motivation</strong> at the <a href="http://www.oscer.ou.edu/acirefvirtres2018.php">2018 ACI-REF Virtual residency</a>. My fellow panel members included:</p>
<ul>
<li>Jerry Perez, U Texas Dallas</li>
<li>Derek Leydig, Pennsylvania State U</li>
<li>Claire Mizumoto, U California San Diego …</li></ul> <a class="btn btn-info xsmall" href="../teams-of-ci-professionals-recruitment-retention-management-team-building-and-motivation-panel-2018-aci-ref-vr.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../leading-and-listening-in-complex-ci-conversations-2018-aci-ref-vr.html"><h2>Leading and Listening in Complex CI Conversations @ 2018 ACI-REF VR</h2></a>
        <div class= "well small"> Mon 06 August 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Graphical Depiction of two people having a complex conversation" hspace="10" src="//www.leamcleod.com/wp-content/uploads/2014/06/Communication-challenge.jpg" width="20%,"></p>
<p>I just got done trying out our latest CyberAmbassador Curriculum developed specifically for the  <a href="http://www.oscer.ou.edu/acirefvirtres2018.php">2018 ACI-REF Virtual residency</a>.</p>
<p>We had some growing pains related to getting zoom breakout rooms working with a large group of people calling in.  Some didn't have working mics, others work in a group room and …</p> <a class="btn btn-info xsmall" href="../leading-and-listening-in-complex-ci-conversations-2018-aci-ref-vr.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../progress-update-on-the-development-and-implementation-of-the-advanced-ci-ref-vr-program.html"><h2>Progress Update on the Development and Implementation of the Advanced CI-REF VR Program</h2></a>
        <div class= "well small"> Wed 25 July 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="ACI-Ref Buiding Picture" hspace="10" src="https://aciref.org/wp-content/uploads/2017/09/FullSizeRender-2-1024x765.jpg" width="20%,"></p>
<p>Henry Neeman did a great job presenting our paper on <a href="https://pearc18.conference-program.com/?page_id=10&amp;id=pap144&amp;sess=sess164">Progress Update for the CI-REF VR Program</a> at <a href="//www.pearc18.pearc.org/">PEARC18</a>.</p>
<p>Writing of this paper was truly a unique experience for me. The entire paper was written virtually over weekly video conference meetings and included the thirteen sited (maximum) authors and I …</p> <a class="btn btn-info xsmall" href="../progress-update-on-the-development-and-implementation-of-the-advanced-ci-ref-vr-program.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../fitting-ice-cube-neutrino-path-models-using-neural-networks.html"><h2>Fitting iCE-Cube Neutrino Path models using Neural Networks</h2></a>
        <div class= "well small"> Tue 24 July 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Mohammed and his poster" hspace="10" src="//colbrydi.github.io/images/Mohammed.jpg" width="30%,"></p>
<p>This summer Mohammed Salih worked with me as part of the Engineering <a href="https://www.egr.msu.edu/graduate/ensure">ENSURE</a> Program.  He presented his work with Jessie Micallef and me as a poster at <a href="https://urca.msu.edu/mid-sure">MidSURE</a>.</p>
<p><strong>Poster Abstract</strong>: Neutrinos are small particles with a mass close to zero. It’s rare interaction with normal matter makes it difficult …</p> <a class="btn btn-info xsmall" href="../fitting-ice-cube-neutrino-path-models-using-neural-networks.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="../campus-champions-101-panel-at-pearc18.html"><h2>Campus Champions 101 Panel at PEARC18</h2></a>
        <div class= "well small"> Mon 23 July 2018

by <a class="url fn" href="../author/dr-dirk-colbry.html">Dr. Dirk Colbry</a>
 


 </div>
        <div class="summary"><p><img align="right," alt="Campus Champion Logo Logo" hspace="10" src="https://www.xsede.org/wwwteragrid/archive/image/image_gallery%3Fuuid=554fecca-1a37-44d0-826f-afad9470153d&amp;groupId=298192&amp;t=1291845274821" width="20%,"></p>
<p>I had an opportunity to participate on the "Researcher Facing" Panel as part of the  <a href="https://www.xsede.org/community-engagement/campus-champions">Campus Champion 101</a> workshop at <a href="https://www.pearc18.pearc.org/">PEARC18</a>.  </p>
<p><a href="//docs.google.com/document/d/1OsOCUOeWAk1IfJzEi8LuO5YnIiKkU2AO-cxzY0F0gzk/edit">Link to Notes For the Panel can be found  here</a></p>
<p>The <a href="https://pearc18.conference-program.com/?page_id=10&amp;id=work108&amp;sess=sess123">Campus Champions 101 workshop</a> explores campus research computing roles. The workshop builds on the Campus Champions’ history and …</p> <a class="btn btn-info xsmall" href="../campus-champions-101-panel-at-pearc18.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="../author/dr-dirk-colbry.html">1</a></li>
    <li class=""><a href="../author/dr-dirk-colbry2.html">2</a></li>
    <li class=""><a href="../author/dr-dirk-colbry3.html">3</a></li>
    <li class=""><a href="../author/dr-dirk-colbry4.html">4</a></li>
    <li class=""><a href="../author/dr-dirk-colbry5.html">5</a></li>
    <li class=""><a href="../author/dr-dirk-colbry6.html">6</a></li>

    <li class="next"><a href="../author/dr-dirk-colbry2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="../archives.html">Archives</a>
                <li><a href="../tags.html">Tags</a>



                <li><a href="https://colbrydi.github.io/feeds/all.atom.xml" rel="alternate">Atom feed</a></li>

            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="../category/fun.html">Fun</a></li>
                <li><a href="../category/professional.html">Professional</a></li>
                   
            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Links
                </li>
            
                <li><a href="//colbrydi.github.io/cyberambassadors/">CyberAmbassadors</a></li>
                <li><a href="//colbrydi.github.io/msupelican/">Pelican / Github.io Tutorial</a></li>
                <li><a href="//cmse.msu.edu">CMSE</a></li>
                <li><a href="//www.msu.edu/">MSU</a></li>
            </ul>
            </div>



        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="..">Dirk's Home Page</a> &copy; Dr. Dirk Colbry 2018</p>
</footer>

</div> <!-- /container -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="../theme/bootstrap-collapse.js"></script>
<script>var _gaq=[['_setAccount','UA-121560886-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
 
</body>
</html>